<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transformers.js Sentiment Analysis</title>
    
    <script type="module">
        import { pipeline } from 'https://cdn.jsdelivr.net/npm/@xenova/transformers';

        // Global variable to hold the loaded model pipeline
        let sentimentPipeline = null; 

        // --- 2. Load the Model ---
        // This function loads the model on the first button click
        async function loadModel() {
            if (sentimentPipeline === null) {
                const outputEl = document.getElementById('output');
                outputEl.innerHTML = "<h4>‚è≥ Loading model (approx. 60MB download)... Please wait.</h4>";
                
                // Initialize the sentiment analysis pipeline. 
                // It automatically selects an optimized model for the task.
                sentimentPipeline = await pipeline('sentiment-analysis', 'Xenova/distilbert-base-uncased-finetuned-sst-2-english');
                
                outputEl.innerHTML = "<h4>‚úÖ Model Loaded. Enter text and click Analyze!</h4>";
                document.getElementById('analyzeButton').removeAttribute('disabled');
            }
        }
        
        // --- 3. Run Inference ---
        window.analyzeSentiment = async function() {
            const inputText = document.getElementById('inputText').value;
            const outputEl = document.getElementById('output');
            
            if (!inputText || inputText.trim() === '') {
                outputEl.innerHTML = "<p>Please enter some text to analyze.</p>";
                return;
            }

            outputEl.innerHTML = "<p>üîç Analyzing sentiment...</p>";

            // Run the input through the pipeline
            const startTime = performance.now();
            const result = await sentimentPipeline(inputText);
            const endTime = performance.now();

            const label = result[0].label;
            const score = result[0].score;
            const time = (endTime - startTime).toFixed(2);

            // Display results
            outputEl.innerHTML = `
                <p><strong>Result:</strong> ${label}</p>
                <p><strong>Confidence:</strong> ${score.toFixed(4)}</p>
                <p>Inference Time: ${time} ms</p>
            `;
        }

        // Load the model immediately when the page loads
        loadModel();
    </script>
    
    <style>
        body { font-family: sans-serif; padding: 20px; max-width: 600px; margin: auto; }
        textarea { width: 100%; height: 100px; padding: 10px; margin-bottom: 10px; box-sizing: border-box; }
        button { background-color: #4CAF50; color: white; padding: 10px 15px; border: none; border-radius: 5px; cursor: pointer; }
        button:disabled { background-color: #ccc; cursor: not-allowed; }
        #output { margin-top: 20px; padding: 15px; border: 1px solid #ddd; background-color: #f9f9f9; border-radius: 5px; }
    </style>
</head>
<body>
    <h1>Sentiment Analysis in the Browser</h1>
    <p>The AI model runs directly on your device using WebAssembly/WebGPU.</p>
    
    <label for="inputText">Enter Text:</label>
    <textarea id="inputText">Transformers.js makes AI inference incredibly simple and fast!</textarea>

    <button id="analyzeButton" onclick="analyzeSentiment()" disabled>Analyze Sentiment</button>

    <div id="output">
        <h4>Initializing...</h4>
    </div>
</body>
</html>
